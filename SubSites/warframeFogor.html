<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8">
<title>WarframeFogorList</title>
<style>
  body {
    background-color:rgb(5, 11, 15);
    display:flex;
    justify-content:space-evenly;
  }

  .mainParent {
    border: 1px solid white;
    border-radius:20px;
    width:47vw;
    min-height:20vh;
    padding:10px;
  }

  h1 {
    color:white;
    margin:0;
  }
</style>
</head>
<body>
<div class="mainParent" id="dailyParent">
  <h1>Daily</h1>
  <div><button onclick='makeInputs("daily")'>add row</button><button onclick='removeInputs("daily")'>remove row</button></div>
</div>

<div class="mainParent" id="weeklyParent">
  <h1>Weekly</h1>
  <div><button onclick='makeInputs("weekly")'>add row</button><button onclick='removeInputs("weekly")'>remove row</button></div>
</div>

<script>
  loadFunction()

  function makeInputs(type, name="", value=0) {
    if (type != "daily" && type != "weekly") {throw new Error("wrong input to make")}
    var inp = document.createElement("input")
    var inpCh = document.createElement("input")
    var order = 1
    document.querySelectorAll(`#${type}Parent input[type="text"]`).forEach((element) => order++)
    inp.setAttribute("id", `inp${order}${type.slice(0,1)}`)
    inp.setAttribute("type", "text")
    inp.setAttribute("value", name)
    inpCh.setAttribute("id", `inp${order}ch${type.slice(0,1)}`)
    inpCh.setAttribute("type", "checkbox")
    if (value == 1) {inpCh.setAttribute("checked","")}
    var dividerDiv = document.createElement("div")
    dividerDiv.appendChild(inp)
    dividerDiv.appendChild(inpCh)
    document.querySelector(`#${type}Parent`).appendChild(dividerDiv)
    saveFunction()
  }

  function removeInputs(type) {document.querySelector(`#${type}Parent`).lastChild.remove();saveFunction()}

  function saveFunction() {
    var dailyNamesArr = []
    document.querySelectorAll('#dailyParent input[type="text"]').forEach((element) => dailyNamesArr.push(element.value))
    localStorage.setItem("dailyNames", JSON.stringify(dailyNamesArr))
    var dailyValuesArr = []
    document.querySelectorAll('#dailyParent input[type="checkbox"]').forEach((element) => {if (element.checked) {dailyValuesArr.push(1)} else {dailyValuesArr.push(0)}})
    localStorage.setItem("dailyValues", JSON.stringify(dailyValuesArr))
    localStorage.setItem("lastDailyUpdate", Math.floor(+Date.now()/86400000))

    var weeklyNamesArr = []
    document.querySelectorAll('#weeklyParent input[type="text"]').forEach((element) => weeklyNamesArr.push(element.value))
    localStorage.setItem("weeklyNames", JSON.stringify(weeklyNamesArr))
    var weeklyValuesArr = []
    document.querySelectorAll('#weeklyParent input[type="checkbox"]').forEach((element) => {if (element.checked) {weeklyValuesArr.push(1)} else {weeklyValuesArr.push(0)}})
    localStorage.setItem("weeklyValues", JSON.stringify(weeklyValuesArr))
    localStorage.setItem("lastWeeklyUpdate", Math.floor(+Date.now()/604800000))
  }

  function loadFunction() {
    console.log(localStorage)
    //if (localStorage.getItem("dailyNames") === null) {makeInputs("daily")}
    dailyNames = JSON.parse(localStorage.getItem("dailyNames"))
    dailyValues = JSON.parse(localStorage.getItem("dailyValues"))
    for (let i = 0; i < dailyNames.length; i++) {
      value = (Math.floor(+Date.now()/86400000) > localStorage.getItem("lastDailyUpdate")) ? 0 : dailyValues[i]
      makeInputs("daily", dailyNames[i], value)
    }

    //if (localStorage.getItem("weeklyNames") === null) {makeInputs("weekly")}
    weeklyNames = JSON.parse(localStorage.getItem("weeklyNames"))
    weeklyValues = JSON.parse(localStorage.getItem("weeklyValues"))
    for (let i = 0; i < weeklyNames.length; i++) {
      value = (Math.floor(+Date.now()/604800000) > localStorage.getItem("lastWeeklyUpdate")) ? 0 : weeklyValues[i]
      makeInputs("weekly", weeklyNames[i], value)
    }
  }
</script>
</body>
</html>
